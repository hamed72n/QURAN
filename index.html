<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق حفظ آيات القرآن</title>
    <style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    background-color: #f0f0f0;
    margin: 0;
    padding: 0;
    width: 100vw;
    height: 100vh;
}

.container {
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    box-sizing: border-box;
}

h2 {
    font-size: 18px;
    color: blue;
    margin-bottom: 1px;
    margin: 0 auto;
}

h1 {
    font-size: 18px;
    color: blue;
    margin-bottom: 1px;
    margin: 0 auto;
}

.input-container {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin-bottom: 10px;
}

button {
    font-size: 16px;
    padding: 5px;
    margin: 1px 1;
    width: 40%;
    border: 2px solid #ccc;
    border-radius: 1px;
    background-color: #28a745;
    color: white;
    cursor: pointer;
}

button:hover {
    opacity: 0.9;
}

table {
    border-collapse: collapse;
    margin-top: 2px;
    width: 100%;
}

table, th, td {
    border: 2px solid black;
    font-weight: bold;
}

th, td {
    padding: 1px;
    text-align: center;
    font-size: 15px;
    font-weight: bold;
}

th {
    background-color: #4CAF50;
    color: white;
}

.remaining {
    font-size: 13px;
    color: green;
}

.timestamp {
    color: #333;
}

.time {
    color: #ff0000;
}

#surahName, #ayah {
    width: 130px;
    font-size: 16px;
    padding: 8px;
    border: 2px solid black;
    border-radius: 5px;
}

@media (max-width: 600px) {
    th, td {
        padding: 2px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <h1>حفظ قراءات القرآن</h1>
        <div class="input-container">
            <select id="surahName">
                <option value="">اختر اسم السورة</option>
            </select>
            <input type="number" id="ayah" placeholder="رقم الآية">
        </div>
        <button id="saveBtn">حفظ الآية</button>
        <button id="clearBtn" style="background-color: #dc3545; margin-top: 10px;">مسح جميع البيانات</button>
        <h2>جدول متابعة القراءة </h2>
        <table id="bookmarksTable">
            <thead>
                <tr>
                    <th>السورة</th>
                    <th>الجزء</th>
                    <th>رقم الآية</th>
                    <th>تاريخ القراءة</th>
                    <th>إجراءات</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <script>
const surahNames = [
    "الفاتحة", "البقرة", "آل عمران", "النساء", "المائدة", "الأنعام", "الأعراف", "الأنفال", "التوبة", "يونس",
    "هود", "يوسف", "الرعد", "إبراهيم", "الحجر", "النحل", "الإسراء", "الكهف", "مريم", "طه",
    "الأنبياء", "الحج", "المؤمنون", "النور", "الفرقان", "الشعراء", "النمل", "القصص", "العنكبوت", "الروم",
    "لقمان", "السجدة", "الأحزاب", "سبأ", "فاطر", "يس", "الصافات", "ص", "الزمر", "غافر",
    "فصلت", "الشورى", "الزخرف", "الدخان", "الجاثية", "الأحقاف", "محمد", "الفتح", "الحجرات", "ق",
    "الذاريات", "الطور", "النجم", "القمر", "الرحمن", "الواقعة", "الحديد", "المجادلة", "الحشر", "الممتحنة",
    "الصف", "الجمعة", "المنافقون", "التغابن", "الطلاق", "التحريم", "الملك", "القلم", "الحاقة", "المعارج",
    "نوح", "الجن", "المزمل", "المدثر", "القيامة", "الإنسان", "المرسلات", "النبأ", "النازعات", "عبس",
    "التكوير", "الانفطار", "المطففين", "الانشقاق", "البروج", "الطارق", "الأعلى", "الغاشية", "الفجر", "البلد",
    "الشمس", "الليل", "الضحى", "الشرح", "التين", "العلق", "القدر", "البينة", "الزلزلة", "العاديات",
    "القارعة", "التكاثر", "العصر", "الهمزة", "الفيل", "قريش", "الماعون", "الكوثر", "الكافرون", "النصر",
    "المسد", "الإخلاص", "الفلق", "الناس"
];

const surahAyahCounts = [
    7, 286, 200, 176, 120, 165, 206, 75, 129, 109,
    123, 111, 43, 52, 99, 128, 111, 110, 98, 135,
    112, 78, 118, 64, 77, 227, 93, 88, 69, 60,
    34, 30, 73, 54, 45, 83, 182, 88, 75, 85,
    54, 53, 89, 59, 37, 35, 38, 29, 18, 45,
    60, 49, 62, 55, 78, 96, 29, 22, 24, 13,
    14, 11, 11, 18, 12, 12, 30, 52, 52, 44,
    28, 28, 20, 56, 40, 31, 50, 40, 46, 42,
    29, 19, 36, 25, 22, 17, 19, 26, 30, 20,
    15, 21, 11, 8, 8, 19, 5, 8, 8, 11,
    11, 8, 3, 9, 5, 4, 7, 3, 6, 3,
    5, 4, 5, 6
];

const juzRanges = [
    { startSurah: 1, startAyah: 1, endSurah: 2, endAyah: 141 },
    { startSurah: 2, startAyah: 142, endSurah: 2, endAyah: 252 },
    { startSurah: 2, startAyah: 253, endSurah: 3, endAyah: 92 },
    { startSurah: 3, startAyah: 93, endSurah: 4, endAyah: 23 },
    { startSurah: 4, startAyah: 24, endSurah: 4, endAyah: 147 },
    { startSurah: 4, startAyah: 148, endSurah: 5, endAyah: 81 },
    { startSurah: 5, startAyah: 82, endSurah: 6, endAyah: 110 },
    { startSurah: 6, startAyah: 111, endSurah: 7, endAyah: 87 },
    { startSurah: 7, startAyah: 88, endSurah: 8, endAyah: 40 },
    { startSurah: 8, startAyah: 41, endSurah: 9, endAyah: 92 },
    { startSurah: 9, startAyah: 93, endSurah: 11, endAyah: 5 },
    { startSurah: 11, startAyah: 6, endSurah: 12, endAyah: 52 },
    { startSurah: 12, startAyah: 53, endSurah: 14, endAyah: 52 },
    { startSurah: 15, startAyah: 1, endSurah: 16, endAyah: 128 },
    { startSurah: 17, startAyah: 1, endSurah: 18, endAyah: 74 },
    { startSurah: 18, startAyah: 75, endSurah: 20, endAyah: 135 },
    { startSurah: 21, startAyah: 1, endSurah: 22, endAyah: 78 },
    { startSurah: 23, startAyah: 1, endSurah: 25, endAyah: 20 },
    { startSurah: 25, startAyah: 21, endSurah: 27, endAyah: 55 },
    { startSurah: 27, startAyah: 56, endSurah: 29, endAyah: 45 },
    { startSurah: 29, startAyah: 46, endSurah: 33, endAyah: 30 },
    { startSurah: 33, startAyah: 31, endSurah: 36, endAyah: 27 },
    { startSurah: 36, startAyah: 28, endSurah: 39, endAyah: 31 },
    { startSurah: 39, startAyah: 32, endSurah: 41, endAyah: 46 },
    { startSurah: 41, startAyah: 47, endSurah: 45, endAyah: 37 },
    { startSurah: 46, startAyah: 1, endSurah: 51, endAyah: 30 },
    { startSurah: 51, startAyah: 31, endSurah: 57, endAyah: 29 },
    { startSurah: 58, startAyah: 1, endSurah: 66, endAyah: 12 },
    { startSurah: 67, startAyah: 1, endSurah: 77, endAyah: 50 },
    { startSurah: 78, startAyah: 1, endSurah: 114, endAyah: 6 }
];

function showAppModal(message, onClose) {
    const modal = document.createElement('div');
    modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:9999;font-family:Arial,sans-serif';
    modal.innerHTML = `
        <div style="background:#fff;padding:22px;border-radius:10px;text-align:center;min-width:240px;max-width:280px;direction:rtl;box-shadow:0 4px 14px rgba(0,0,0,.25)">
            <p style="margin:0 0 16px;font-size:15px;color:#222;line-height:1.5">${message}</p>
            <button id="closeBtn" style="background:#007bff;color:#fff;border:none;padding:7px 20px;border-radius:5px;cursor:pointer;font-size:14px">حسنًا</button>
        </div>
    `;
    document.body.appendChild(modal);
    modal.querySelector('#closeBtn').onclick = () => { modal.remove(); if(onClose) onClose(); };
}

function showAppConfirm(message, onConfirm, onCancel) {
    const modal = document.createElement('div');
    modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:9999;font-family:Arial,sans-serif';
    modal.innerHTML = `
        <div style="background:#fff;padding:22px;border-radius:10px;text-align:center;min-width:240px;max-width:280px;direction:rtl;box-shadow:0 4px 14px rgba(0,0,0,.25)">
            <p style="margin:0 0 18px;font-size:15px;color:#222;line-height:1.5">${message}</p>
            <div style="display:flex;justify-content:center;gap:10px">
                <button id="confirmBtn" style="background:#dc3545;color:#fff;border:none;padding:7px 18px;border-radius:5px;cursor:pointer;font-size:14px">نعم</button>
                <button id="cancelBtn" style="background:#6c757d;color:#fff;border:none;padding:7px 18px;border-radius:5px;cursor:pointer;font-size:14px">إلغاء</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    modal.querySelector('#confirmBtn').onclick = () => { modal.remove(); if(onConfirm) onConfirm(); };
    modal.querySelector('#cancelBtn').onclick = () => { modal.remove(); if(onCancel) onCancel(); };
}

function validateAyahInput(ayah, surahName) {
    const surahNumber = surahNames.indexOf(surahName) + 1;
    const maxAyah = surahAyahCounts[surahNumber - 1];

    if (!ayah || isNaN(ayah) || parseInt(ayah) <= 0) {
        showAppModal("يرجى إدخال رقم آية صحيح وموجب.");
        return false;
    }

    if (parseInt(ayah) > maxAyah) {
        showAppModal(`رقم الآية يجب أن يكون بين 1 و ${maxAyah} لسورة ${surahName}`);
        return false;
    }

    return true;
}

function formatTimestamp(timestamp) {
    const date = new Date(timestamp);
    if (isNaN(date.getTime())) {
        return "تاريخ غير صالح";
    }
    const day = date.getDate();
    const month = date.getMonth() + 1;
    const year = date.getFullYear();
    const hours = date.getHours();
    const minutes = date.getMinutes();
    const ampm = hours >= 12 ? 'م' : 'ص';
    const formattedHours = hours % 12 || 12;
    return `${day}/${month}/${year} <span class="time">الساعه:${formattedHours}:${minutes < 10 ? '0' + minutes : minutes} ${ampm}</span>`;
}

function getJuzNumber(surahNumber, ayahNumber) {
    for (let i = 0; i < juzRanges.length; i++) {
        const range = juzRanges[i];
        if (
            (surahNumber > range.startSurah || (surahNumber === range.startSurah && ayahNumber >= range.startAyah)) &&
            (surahNumber < range.endSurah || (surahNumber === range.endSurah && ayahNumber <= range.endAyah))
        ) {
            return `الجزء (${i + 1})`;
        }
    }
    return "الجزء (1)";
}

function getRemainingJuz(currentJuz) {
    const totalJuz = 30;
    const remaining = totalJuz - currentJuz;
    return `الأجزاء المتبقية: ${remaining}`;
}

function getRemainingSurah(currentSurah) {
    const totalSurah = 114;
    const remaining = totalSurah - currentSurah;
    return `السور المتبقية: ${remaining}`;
}

let bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || [];

function initializeApp() {
    populateSurahSelect();
    displayBookmarks();
    document.getElementById('clearBtn').addEventListener('click', clearAllData);
    document.getElementById('saveBtn').addEventListener('click', saveAyah);
}

function populateSurahSelect() {
    const surahNameSelect = document.getElementById('surahName');
    surahNames.forEach((name) => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        surahNameSelect.appendChild(option);
    });
}

function saveAyah() {
    const surahName = document.getElementById('surahName').value;
    const ayah = document.getElementById('ayah').value;

    if (!validateAyahInput(ayah, surahName)) {
        return;
    }

    if (surahName && ayah) {
        const surahNumber = surahNames.indexOf(surahName) + 1;
        const ayahNumber = parseInt(ayah);

        // التحقق من التكرار
        const exists = bookmarks.some(b => b.surahName === surahName && b.ayah === ayah);
        if (exists) {
            showAppModal('هذه الآية محفوظة مسبقًا');
            return;
        }

        const juz = getJuzNumber(surahNumber, ayahNumber);
        const timestamp = new Date().toISOString();

        bookmarks.unshift({ surahName, juz, ayah, timestamp });
        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        displayBookmarks();

        document.getElementById('surahName').value = '';
        document.getElementById('ayah').value = '';
    } else {
        showAppModal('الرجاء إدخال اسم السورة ورقم الآية');
    }
}

function displayBookmarks() {
    const tableBody = document.querySelector('#bookmarksTable tbody');
    tableBody.innerHTML = '';
    bookmarks.forEach((bookmark, index) => {
        const surahNumber = surahNames.indexOf(bookmark.surahName) + 1;
        const juzNumber = parseInt((bookmark.juz || '').match(/\d+/)?.[0] || 1);

        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                ${bookmark.surahName}<br>
                <span class="remaining">${getRemainingSurah(surahNumber)}</span>
            </td>
            <td>
                ${bookmark.juz}<br>
                <span class="remaining">${getRemainingJuz(juzNumber)}</span>
            </td>
            <td>${bookmark.ayah}</td>
            <td class="timestamp">${formatTimestamp(bookmark.timestamp)}</td>
        `;

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'حذف';
        deleteBtn.style.cssText = 'margin:2px;padding:2px 6px;font-size:12px;background:#dc3545;color:#fff;border:none;border-radius:3px;cursor:pointer';
        deleteBtn.onclick = () => deleteBookmark(index);

        const editBtn = document.createElement('button');
        editBtn.textContent = 'تعديل';
        editBtn.style.cssText = 'margin:2px;padding:2px 6px;font-size:12px;background:#007bff;color:#fff;border:none;border-radius:3px;cursor:pointer';
        editBtn.onclick = () => editBookmark(index);

        const actionsTd = document.createElement('td');
        actionsTd.appendChild(deleteBtn);
        actionsTd.appendChild(document.createElement('br'));
        actionsTd.appendChild(editBtn);
        row.appendChild(actionsTd);

        tableBody.appendChild(row);
    });
}

function editBookmark(index) {
    const bookmark = bookmarks[index];
    const newSurah = prompt(`تعديل السورة (أترك فارغًا للإبقاء على ${bookmark.surahName}):`, '');
    if (newSurah && !surahNames.includes(newSurah)) {
        showAppModal("يجب كتابة اسم السورة كما هي في قائمة السور حتى يستطيع البرنامج الارتكاز عليها في حساب السور المتبقية.");
        return;
    }
    const newAyahStr = prompt(`تعديل رقم الآية (أترك فارغًا للإبقاء على ${bookmark.ayah}):`, '');
    const newAyah = newAyahStr ? parseInt(newAyahStr) : bookmark.ayah;

    if (newSurah || newAyahStr) {
        const surahName = newSurah || bookmark.surahName;
        const ayah = newAyahStr ? parseInt(newAyahStr) : bookmark.ayah;
        if (!validateAyahInput(ayah, surahName)) return;
        const surahNumber = surahNames.indexOf(surahName) + 1;
        bookmarks[index] = {
            surahName,
            juz: getJuzNumber(surahNumber, ayah),
            ayah,
            timestamp: bookmark.timestamp
        };
        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        displayBookmarks();
    }
}

function deleteBookmark(index) {
    const bookmark = bookmarks[index];
    showAppConfirm(`هل أنت متأكد من حذف آية ${bookmark.ayah} من سورة ${bookmark.surahName}؟`, () => {
        bookmarks.splice(index, 1);
        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        displayBookmarks();
    });
}

function clearAllData() {
    if (!bookmarks.length) {
        showAppModal('لا توجد بيانات لمسحها');
        return;
    }
    showAppConfirm('هل أنت متأكد من مسح جميع البيانات؟ لا يمكن التراجع عن هذا الإجراء.', () => {
        bookmarks = [];
        localStorage.removeItem('bookmarks');
        displayBookmarks();
    });
}

document.addEventListener('DOMContentLoaded', () => {
    initializeApp();
});
    </script>
</body>
</html>